@using AirPlane.WebUI.Models.MVCGuide
@model string
@{
    ViewBag.Title = "GetPeopleAjax";
    Layout = "~/Views/Shared/_Layout.cshtml";
    AjaxOptions ajaxOpts = new AjaxOptions
    {
        UpdateTargetId = "tableBody",
        Url = Url.Action("GetPeopleData", new { selectedRole = Model }),
        LoadingElementId  = "loadingPanel",
        LoadingElementDuration = 1000,
        Confirm = "Do You want to load new data ?",
        OnComplete = "OnComplete",
        OnBegin = "NotComplete"
    };
}

<h2>GetPeopleAjax</h2>

<table>
    <thead><tr><th>First</th><th>Last</th><th>Role</th></tr></thead>
    <tbody id="tableBody">
        @Html.Action("GetPeopleData", new { selectedRole = Model })
    </tbody>
</table>
@using (Ajax.BeginForm( ajaxOpts ))
{
    <div>
        @Html.DropDownList("selectedRole", new SelectList(
new[] { "All" }.Concat(Enum.GetNames(typeof(Role)))))
        <button type="submit">Submit</button>
    </div>
    <div id="loadingPanel" style="display:none">
        <p>Loading...</p>
    </div>

    <div>
        @foreach(string role in Enum.GetNames(typeof(Role)))
        {
            <div class="ajaxLink">
                @Ajax.ActionLink(role,"GetPeopleData",new { selectedRole = role}, new AjaxOptions { UpdateTargetId = "tableBody"})

            </div>
        }
    </div>
<br />
<div>
    @foreach (string role in Enum.GetNames(typeof(Role)))
    {
        <div class="ajaxLink">
            @Ajax.ActionLink(role, "GetPeopleAjax", new { selectedRole = role }, new AjaxOptions {
           Url = Url.Action("GetPeopleDataJson", new
           { selectedRole = role }),
             OnSuccess = "processData"
       })

        </div>
    }
</div>
<div id="JavaMessage"></div>
    <script>
        function OnComplete()
        {
            document.getElementById("JavaMessage").innerHTML = "Finished"
        }
        function NotComplete() {
            document.getElementById("JavaMessage").innerHTML = ""
        }
        function processData(data) {
            var target = $("#tableBody");
            target.empty();
            for (var i = 0; i < data.length; i++) {
                var person = data[i];
                target.append("<tr><td>" + person.FirstName + "</td><td>"
                + person.LastName + "</td><td>" + person.Role + "</td></tr>");
            }
        }

    </script>

}